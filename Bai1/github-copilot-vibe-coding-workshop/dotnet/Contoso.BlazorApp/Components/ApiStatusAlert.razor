@inject ApiService ApiService
@inject ILogger<ApiStatusAlert> Logger
@implements IDisposable

<div class="api-status">
    @if (isCheckingApi)
    {
        <div class="status-checking">
            <div class="spinner"></div>
            <span>Checking API connection...</span>
        </div>
    }
    else if (apiConnected)
    {
        <div class="status-success">
            <span class="status-icon">✓</span>
            <span>Backend API is running on http://localhost:8080</span>
        </div>
    }
    else
    {
        <div class="status-error">
            <span class="status-icon">⚠</span>
            <span>Backend API is unavailable. Please check if the server is running on http://localhost:8080</span>
        </div>
    }
</div>

@code {
    private bool apiConnected = false;
    private bool isCheckingApi = true;
    private Timer? apiCheckTimer;

    protected override async Task OnInitializedAsync()
    {
        await CheckApiHealthAsync();
        
        // Check API status every 30 seconds
        apiCheckTimer = new Timer(async _ => await CheckApiHealthAsync(), null, TimeSpan.FromSeconds(30), TimeSpan.FromSeconds(30));
    }

    private async Task CheckApiHealthAsync()
    {
        try
        {
            isCheckingApi = true;
            StateHasChanged();

            Logger.LogInformation("Checking API health...");
            apiConnected = await ApiService.CheckApiHealthAsync();
            
            if (apiConnected)
            {
                Logger.LogInformation("API is connected!");
            }
            else
            {
                Logger.LogWarning("API connection failed");
            }
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, "API health check failed");
            apiConnected = false;
        }
        finally
        {
            isCheckingApi = false;
            StateHasChanged();
        }
    }

    public void Dispose()
    {
        apiCheckTimer?.Dispose();
    }
}