@inject ApiService ApiService
@inject ILogger<LikeButton> Logger

<button class="like-button @(isLiked ? "liked" : "")" @onclick="ToggleLikeAsync" disabled="@isUpdating">
    <span class="like-icon">❤️</span>
    <span>@LikesCount like@(LikesCount == 1 ? "" : "s")</span>
    @if (isUpdating)
    {
        <span class="spinner-small"></span>
    }
</button>

@code {
    [Parameter] public int PostId { get; set; }
    [Parameter] public int LikesCount { get; set; }
    [Parameter] public EventCallback OnLikeChanged { get; set; }

    private bool isLiked = false;
    private bool isUpdating = false;

    private async Task ToggleLikeAsync()
    {
        // For demo purposes, we'll prompt for username
        var username = PromptForUsername();
        if (string.IsNullOrWhiteSpace(username))
            return;

        try
        {
            isUpdating = true;
            
            var likeRequest = new LikeRequest { Username = username };
            
            if (isLiked)
            {
                await ApiService.UnlikePostAsync(PostId, likeRequest);
                isLiked = false;
            }
            else
            {
                await ApiService.LikePostAsync(PostId, likeRequest);
                isLiked = true;
            }

            await OnLikeChanged.InvokeAsync();
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, "Failed to toggle like for post {PostId}", PostId);
        }
        finally
        {
            isUpdating = false;
        }
    }

    private string PromptForUsername()
    {
        // This is a simple implementation - in a real app you'd have user management
        // For now, we'll use a simple prompt (would need JSInterop for real implementation)
        return "demo_user"; // Simplified for demo
    }
}